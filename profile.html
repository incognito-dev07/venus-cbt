<!DOCTYPE html>
<html>
<head>
  <title>Venus CBT - Profile</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="styles/core.css">
  <link rel="stylesheet" href="styles/component.css">
  <link rel="stylesheet" href="styles/pages.css">
  <link rel="stylesheet" href="styles/responsive.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
</head>
<body>
  <div class="container">
    <div class="profile-box">
      <h2><i class="fas fa-user-circle"></i> My Profile</h2>
            
      <div id="messageContainer"></div>
      
      <div class="profile-image-container">
        <div class="profile-image-wrapper">
          <img src="" alt="Profile" class="profile-image" id="profileImage" style="display: none;">
          <div class="default-avatar" id="defaultAvatar">
            <i class="fas fa-user-circle"></i>
          </div>
          
          <form id="imageUploadForm">
            <input type="file" name="profile_image" id="profileImageInput" accept="image/*" style="display: none;">
            <button type="button" class="image-upload-btn" onclick="document.getElementById('profileImageInput').click();">
              <i class="fas fa-camera"></i>
            </button>
          </form>
        </div>
        <div class="profile-username">
          <h3 id="displayUsername">Loading...</h3>
        </div>
        
        <div class="profile-stats" id="profileStats">
          <span><i class="fas fa-fire"></i> <span id="streakValue">0</span> <span id="streakText">days</span> streak</span>
        </div>
      </div>
      
      <div class="info-card bio">
        <div class="info-item">
          <div class="info-header">
            <i class="fas fa-quote-left"></i>
            <span class="info-label">Bio</span>
          </div>
          <span class="info-value" id="bioDisplay">No bio yet</span>
        </div>
        
        <div class="info-item">
          <div class="info-header">
            <i class="fas fa-calendar-alt"></i>
            <span class="info-label">Joined:</span>
            <span class="info-value-short" id="joinDate">Feb 21, 2026</span>
          </div>
        </div>
      </div>
      
      <button class="btn btn-primary btn-block edit-bio-btn" onclick="toggleBioForm()">
        <i class="fas fa-edit"></i> Edit Bio
      </button>
      
      <div class="upload-form" id="bioForm" style="display: none;">
        <h3><i class="fas fa-edit"></i> Update Bio</h3>
        <div class="form-group">
          <textarea id="bioInput" rows="3" placeholder="Write something about yourself..." maxlength="120"></textarea>
          <small style="color: var(--text-secondary); display: block; margin-top: 0.25rem; font-size: 0.8rem;">
            <span id="bioCharCount">0</span>/120 characters
          </small>
        </div>
        <button type="button" class="btn btn-primary btn-block" onclick="saveBio()" style="margin-bottom: 0.7rem;">
          <i class="fas fa-save"></i> Save Bio
        </button>
        <button type="button" class="btn btn-danger btn-block" onclick="toggleBioForm()">
          <i class="fas fa-arrow-left"></i> Back
        </button>
      </div>

      <div class="stats-section">
        <h3><i class="fas fa-chart-bar"></i> Statistics</h3>
        
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-pencil-alt"></i>
            </div>
            <div class="stat-content">
              <span class="stat-value" id="testsTaken">0</span>
              <span class="stat-label">Tests Taken</span>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-percent"></i>
            </div>
            <div class="stat-content">
              <span class="stat-value" id="avgScore">0%</span>
              <span class="stat-label">Average Score</span>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-star"></i>
            </div>
            <div class="stat-content">
              <span class="stat-value" id="bestCourse">N/A</span>
              <span class="stat-label">Best Course</span>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-trophy"></i>
            </div>
            <div class="stat-content">
              <span class="stat-value" id="bestScore">0%</span>
              <span class="stat-label">Best Score</span>
            </div>
          </div>
        </div>
      </div>

      <div class="achievements-section">
        <h3><i class="fas fa-medal"></i> Achievements</h3>
        
        <div class="achievements-grid" id="achievementsGrid">
          <div class="no-achievements">
            <i class="fas fa-medal"></i>
            <p>Complete tests to earn achievements!</p><br>
            <a href="select-test.html" class="btn btn-primary btn-small">Start a Test</a>
          </div>
        </div>
      </div>
            
      <div class="btn-group">
        <a href="history.html" class="btn btn-primary"><i class="fas fa-history"></i> History</a>
        <a href="index.html" class="btn btn-primary"><i class="fas fa-home"></i> Home</a>
      </div>
    </div>
  </div>

  <script src="scripts/utilities.js"></script>
  <script src="scripts/storage.js"></script>
  <script src="scripts/index.js"></script>
  <script src="scripts/history.js"></script>
  <script src="scripts/profile.js"></script>
  <script>
    function toggleBioForm() {
      const bioForm = document.getElementById('bioForm');
      const bioInput = document.getElementById('bioInput');
      const currentBio = document.getElementById('bioDisplay').textContent;
      
      if (bioForm.style.display === 'none') {
        bioForm.style.display = 'block';
        if (currentBio && currentBio !== 'No bio yet') {
          bioInput.value = currentBio;
          document.getElementById('bioCharCount').textContent = currentBio.length;
        } else {
          bioInput.value = '';
          document.getElementById('bioCharCount').textContent = '0';
        }
      } else {
        bioForm.style.display = 'none';
      }
    }

    function saveBio() {
      const bio = document.getElementById('bioInput').value.trim();
      
      if (bio.length > 120) {
        Utils.showMessage('Bio must be 120 characters or less!', 'error');
        return;
      }
      
      ProfileManager.updateBio(bio || 'No bio yet');
      toggleBioForm();
    }

    document.getElementById('profileImageInput').addEventListener('change', function(e) {
      if (this.files && this.files[0]) {
        if (this.files[0].size > 5 * 1024 * 1024) {
          Utils.showMessage('Image size must be less than 5MB!', 'error');
          this.value = '';
          return;
        }
        
        if (!this.files[0].type.match('image.*')) {
          Utils.showMessage('Only image files are allowed!', 'error');
          this.value = '';
          return;
        }
        
        const reader = new FileReader();
        reader.onload = function(e) {
          ProfileManager.updateAvatar(e.target.result);
        };
        reader.readAsDataURL(this.files[0]);
      }
    });
  </script>
</body>
</html>